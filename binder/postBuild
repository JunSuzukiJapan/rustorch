#!/bin/bash

# Binder post-build script for RusTorch
set -e

echo "ğŸ”§ Building RusTorch Python bindings for Binder..."

# Set conda environment variables for maturin
export CONDA_PREFIX=${NB_PYTHON_PREFIX}
export VIRTUAL_ENV=${NB_PYTHON_PREFIX}

# Build wheel and install (compatible with conda environment)
echo "ğŸ“¦ Building wheel..."
maturin build --release --out dist

# Install the built wheel
echo "ğŸ“¥ Installing wheel..."
pip install dist/*.whl

# Test the installation
echo "ğŸ§ª Testing installation..."
python3 -c "
try:
    import rustorch
    print('âœ… RusTorch successfully installed in Binder!')
    print('âœ… RusTorch Binderã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æˆåŠŸï¼')
except ImportError as e:
    print(f'âŒ Import failed: {e}')
    exit(1)
"

echo "âœ… RusTorch Binder setup complete!"