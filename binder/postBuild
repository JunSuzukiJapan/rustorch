#!/bin/bash

# Binder post-build script for RusTorch
set -e

echo "🔧 Building RusTorch Python bindings for Binder..."

# Set conda environment variables for maturin
export CONDA_PREFIX=${NB_PYTHON_PREFIX}
export VIRTUAL_ENV=${NB_PYTHON_PREFIX}

# Build wheel and install (compatible with conda environment)
echo "📦 Building wheel..."
maturin build --release --out dist

# Install the built wheel
echo "📥 Installing wheel..."
pip install dist/*.whl

# Test the installation
echo "🧪 Testing installation..."
python3 -c "
try:
    import rustorch
    print('✅ RusTorch successfully installed in Binder!')
    print('✅ RusTorch Binderインストール成功！')
except ImportError as e:
    print(f'❌ Import failed: {e}')
    exit(1)
"

echo "✅ RusTorch Binder setup complete!"