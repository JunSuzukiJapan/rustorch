# フェーズ４リファクタリング計画

## 完了済み改善
1. ✅ 算術演算子の重複除去 - マクロによる抽象化実装

## 優先リファクタリング項目

### 🔴 高優先度
1. **生ポインタ除去** (grad_utils.rs:185-202)
   - Variable IDシステム導入でHashSet<*const Variable<T>>を置換
   
2. **エラーハンドリング統一** (全モジュール)
   - thiserrorクレート導入
   - 具体的エラータイプ定義
   
3. **循環参照解決** (mod.rs:202-207)
   - GradFnでWeakリファレンス使用

### 🟡 中優先度  
1. **入力検証統一** (複数ファイル)
   - validate_inputs共通関数作成
   
2. **パフォーマンス最適化**
   - ロック回数最小化
   - 並列化（rayon使用）
   
3. **メモリ効率化**
   - 過度なclone削減
   - Cow<T>パターン採用

### 🟢 低優先度
1. **命名規則統一**
2. **ドキュメント拡充**  
3. **テストカバレッジ向上**

## 実装戦略
各改善は独立して実行可能。高優先度から順次実装し、各ステップでテスト実行して安定性確保。