#!/bin/bash

# Binder post-build script for RusTorch
# RusTorchç”¨Binderãƒã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

set -e

echo "ğŸ”§ Building RusTorch for Binder..."
echo "ğŸ”§ Binderç”¨RusTorchã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."

# Ensure we're in the right directory
cd $HOME

# Build RusTorch Python bindings (CPU-only for Binder)
echo "ğŸ“¦ Building Python bindings..."
echo "ğŸ“¦ Pythonãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’ãƒ“ãƒ«ãƒ‰ä¸­..."
maturin develop --release

# Verify installation
echo "ğŸ§ª Testing installation..."
echo "ğŸ§ª ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆä¸­..."
python3 -c "
try:
    import rustorch
    print('âœ… RusTorch imported successfully!')
    print('âœ… RusTorchã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«æˆåŠŸã—ã¾ã—ãŸï¼')
except ImportError as e:
    print(f'âŒ Import failed: {e}')
    print('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ')
    exit(1)
"

# Enable Jupyter Lab extensions
echo "ğŸ¨ Enabling Jupyter Lab extensions..."
echo "ğŸ¨ Jupyter Labæ‹¡å¼µæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ä¸­..."
jupyter labextension install @jupyter-widgets/jupyterlab-manager --no-build || true
jupyter lab build --minimize=False || true

echo "âœ… Binder setup complete!"
echo "âœ… Binderã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼"