#!/bin/bash

# RusTorch Universal Jupyter Installer
# ç’°å¢ƒè‡ªå‹•æ¤œå‡ºãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼

set -e

# Default installation path for launcher script
DEFAULT_INSTALL_PATH="$HOME/bin"
INSTALL_PATH="${RUSTORCH_INSTALL_PATH:-$DEFAULT_INSTALL_PATH}"

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "ğŸš€ RusTorch Universal Jupyter Installer"
echo "ğŸš€ RusTorchä¸‡èƒ½Jupyterã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼"
echo ""

# Function to detect OS
detect_os() {
    case "$OSTYPE" in
        darwin*)  echo "macos" ;;
        linux*)   echo "linux" ;;
        msys*|mingw*|cygwin*) echo "windows" ;;
        *)        echo "unknown" ;;
    esac
}

# Function to detect CPU architecture
detect_cpu() {
    local arch=$(uname -m)
    case "$arch" in
        x86_64|amd64) echo "x64" ;;
        arm64|aarch64) echo "arm64" ;;
        armv7l) echo "arm32" ;;
        *) echo "unknown" ;;
    esac
}

# Function to detect GPU capabilities
detect_gpu() {
    local gpu_support=""
    
    # Check for NVIDIA GPU (CUDA)
    if command -v nvidia-smi >/dev/null 2>&1; then
        gpu_support="cuda"
    # Check for Apple Silicon (Metal)
    elif [[ "$(detect_os)" == "macos" ]] && [[ "$(detect_cpu)" == "arm64" ]]; then
        gpu_support="metal"
    # Check for AMD/Intel GPU (OpenCL) - basic check
    elif command -v clinfo >/dev/null 2>&1; then
        gpu_support="opencl"
    else
        gpu_support="cpu"
    fi
    
    echo "$gpu_support"
}

# Function to check browser compatibility for WebGPU
check_webgpu_support() {
    local os=$(detect_os)
    # WebGPU works best on Chrome/Chromium on all platforms
    if command -v google-chrome >/dev/null 2>&1 || 
       command -v chromium-browser >/dev/null 2>&1 || 
       command -v chromium >/dev/null 2>&1; then
        echo "true"
    else
        echo "false"
    fi
}

# Function to create launcher script
create_launcher() {
    local install_type="$1"
    local project_path="$2"
    local launcher_name="rustorch-jupyter"
    local launcher_path="$INSTALL_PATH/$launcher_name"
    
    # Create install directory if it doesn't exist
    mkdir -p "$INSTALL_PATH"
    
    cat > "$launcher_path" << EOF
#!/bin/bash
# RusTorch Jupyter Launcher - Generated by Universal Installer
# Installation type: $install_type
# Default project path: $project_path

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Default configuration
DEFAULT_RUSTORCH_PROJECT_DIR="$project_path"
LAUNCHER_SCRIPT="\$0"

# Function to show help
show_help() {
    echo "ğŸš€ RusTorch Jupyter Launcher"
    echo "ğŸš€ RusTorch Jupyterãƒ©ãƒ³ãƒãƒ£ãƒ¼"
    echo ""
    echo "Usage / ä½¿ç”¨æ–¹æ³•:"
    echo "  \$0                          # Launch with default directory"
    echo "  \$0 --dir <path>             # Launch with custom directory"
    echo "  \$0 --uninstall              # Uninstall RusTorch Jupyter"
    echo "  \$0 --help                   # Show this help"
    echo ""
    echo "Examples / ä¾‹:"
    echo "  \$0"
    echo "  \$0 --dir /path/to/rustorch"
    echo "  \$0 --uninstall"
    echo ""
    echo "Default directory / ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:"
    echo "  \$DEFAULT_RUSTORCH_PROJECT_DIR"
    echo ""
}

# Function to uninstall
uninstall_rustorch() {
    echo -e "\${RED}ğŸ—‘ï¸  RusTorch Jupyter Uninstaller\${NC}"
    echo -e "\${RED}ğŸ—‘ï¸  RusTorch Jupyterã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼\${NC}"
    echo ""
    
    echo "The following will be removed / ä»¥ä¸‹ãŒå‰Šé™¤ã•ã‚Œã¾ã™:"
    echo "  â€¢ Launcher script: \$LAUNCHER_SCRIPT"
    echo "  â€¢ ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: \$LAUNCHER_SCRIPT"
    if [[ -d "\$DEFAULT_RUSTORCH_PROJECT_DIR" ]]; then
        echo "  â€¢ Project directory: \$DEFAULT_RUSTORCH_PROJECT_DIR"
        echo "  â€¢ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: \$DEFAULT_RUSTORCH_PROJECT_DIR"
    fi
    echo ""
    
    read -p "Are you sure? (y/N): " -n 1 -r
    echo
    if [[ \$REPLY =~ ^[Yy]\$ ]]; then
        echo "ğŸ—‘ï¸  Removing RusTorch installation..."
        echo "ğŸ—‘ï¸  RusTorchã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’å‰Šé™¤ä¸­..."
        
        # Remove project directory
        if [[ -d "\$DEFAULT_RUSTORCH_PROJECT_DIR" ]]; then
            rm -rf "\$DEFAULT_RUSTORCH_PROJECT_DIR"
            echo "âœ… Removed project directory / ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
        fi
        
        # Remove launcher script
        rm -f "\$LAUNCHER_SCRIPT"
        echo "âœ… Removed launcher script / ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ"
        
        echo ""
        echo -e "\${GREEN}ğŸ‰ RusTorch Jupyter successfully uninstalled!\${NC}"
        echo -e "\${GREEN}ğŸ‰ RusTorch JupyterãŒæ­£å¸¸ã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã—ãŸï¼\${NC}"
        echo ""
        echo "ğŸ’¡ To reinstall, run:"
        echo "ğŸ’¡ å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯:"
        echo "   curl -sSL https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/install_jupyter.sh | bash"
        
        exit 0
    else
        echo "âŒ Uninstall cancelled / ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ"
        exit 0
    fi
}

# Function to verify and launch RusTorch
launch_rustorch() {
    local project_dir="\$1"
    
    echo "ğŸš€ RusTorch Jupyter Launcher"
    echo "ğŸš€ RusTorch Jupyterãƒ©ãƒ³ãƒãƒ£ãƒ¼"
    echo ""
    echo -e "ğŸ“ Project directory: \${BLUE}\$project_dir\${NC}"
    echo -e "ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: \${BLUE}\$project_dir\${NC}"
    
    # Check if project directory exists
    if [[ ! -d "\$project_dir" ]]; then
        echo -e "\${RED}âŒ RusTorch project directory not found: \$project_dir\${NC}"
        echo -e "\${RED}âŒ RusTorchãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: \$project_dir\${NC}"
        echo ""
        echo "ğŸ”„ Please check the path or reinstall using:"
        echo "ğŸ”„ ãƒ‘ã‚¹ã‚’ç¢ºèªã™ã‚‹ã‹ã€å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:"
        echo "   curl -sSL https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/install_jupyter.sh | bash"
        exit 1
    fi
    
    # Store current directory to return to it later
    ORIGINAL_DIR="\$(pwd)"
    
    # Navigate to project directory
    cd "\$project_dir" || {
        echo -e "\${RED}âŒ Failed to navigate to \$project_dir\${NC}"
        echo -e "\${RED}âŒ \$project_dir ã¸ã®ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ\${NC}"
        exit 1
    }
    
    # Verify this is a RusTorch project
    if [[ ! -f "Cargo.toml" ]] || ! grep -q "rustorch" "Cargo.toml" 2>/dev/null; then
        echo -e "\${RED}âŒ Invalid RusTorch project directory: \$project_dir\${NC}"
        echo -e "\${RED}âŒ ç„¡åŠ¹ãªRusTorchãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: \$project_dir\${NC}"
        echo ""
        echo "ğŸ”„ Please check the path or reinstall using:"
        echo "ğŸ”„ ãƒ‘ã‚¹ã‚’ç¢ºèªã™ã‚‹ã‹ã€å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„:"
        echo "   curl -sSL https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/install_jupyter.sh | bash"
        exit 1
    fi
    
    echo -e "\${GREEN}âœ… RusTorch project verified\${NC}"
    echo -e "\${GREEN}âœ… RusTorchãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèªã—ã¾ã—ãŸ\${NC}"
    echo ""
    
    # Use the existing quick launcher
    if [[ -f "./start_jupyter_quick.sh" ]]; then
        echo "ğŸš€ Starting Jupyter environment..."
        echo "ğŸš€ Jupyterç’°å¢ƒã‚’é–‹å§‹ä¸­..."
        ./start_jupyter_quick.sh
    else
        echo -e "\${RED}âŒ start_jupyter_quick.sh not found in project directory\${NC}"
        echo -e "\${RED}âŒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«start_jupyter_quick.shãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\${NC}"
        echo ""
        echo "ğŸ”„ Please update your RusTorch installation:"
        echo "ğŸ”„ RusTorchã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¦ãã ã•ã„:"
        echo "   cd \$project_dir && git pull"
        exit 1
    fi
    
    # Return to original directory if Jupyter exits
    cd "\$ORIGINAL_DIR"
}

# Parse command line arguments
while [[ \$# -gt 0 ]]; do
    case \$1 in
        --dir|-d)
            CUSTOM_DIR="\$2"
            shift 2
            ;;
        --uninstall)
            uninstall_rustorch
            ;;
        --help|-h)
            show_help
            exit 0
            ;;
        *)
            echo "Unknown option: \$1"
            echo "Use --help for usage information"
            exit 1
            ;;
    esac
done

# Determine which directory to use
if [[ -n "\$CUSTOM_DIR" ]]; then
    # Use custom directory if provided
    RUSTORCH_PROJECT_DIR="\$CUSTOM_DIR"
    echo "Using custom directory: \$RUSTORCH_PROJECT_DIR"
    echo "ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨: \$RUSTORCH_PROJECT_DIR"
    echo ""
else
    # Use default directory
    RUSTORCH_PROJECT_DIR="\$DEFAULT_RUSTORCH_PROJECT_DIR"
fi

# Launch RusTorch
launch_rustorch "\$RUSTORCH_PROJECT_DIR"
EOF
    
    chmod +x "$launcher_path"
    echo "$launcher_path"
}

# Function to add to PATH
add_to_path() {
    local install_dir="$1"
    local shell_rc=""
    
    # Detect shell and corresponding RC file
    if [[ "$SHELL" == *"zsh"* ]]; then
        shell_rc="$HOME/.zshrc"
    elif [[ "$SHELL" == *"bash"* ]]; then
        if [[ -f "$HOME/.bashrc" ]]; then
            shell_rc="$HOME/.bashrc"
        else
            shell_rc="$HOME/.bash_profile"
        fi
    elif [[ "$SHELL" == *"fish"* ]]; then
        shell_rc="$HOME/.config/fish/config.fish"
    fi
    
    # Check if PATH already contains the directory
    if [[ ":$PATH:" != *":$install_dir:"* ]]; then
        if [[ -n "$shell_rc" ]]; then
            echo "" >> "$shell_rc"
            echo "# Added by RusTorch installer" >> "$shell_rc"
            if [[ "$shell_rc" == *"fish"* ]]; then
                echo "set -gx PATH $install_dir \$PATH" >> "$shell_rc"
            else
                echo "export PATH=\"$install_dir:\$PATH\"" >> "$shell_rc"
            fi
            echo "âœ… Added $install_dir to PATH in $shell_rc"
        fi
    fi
}

# Main detection and installation logic
main() {
    echo "ğŸ” Environment Detection / ç’°å¢ƒæ¤œå‡º"
    echo "=================================="
    
    local os=$(detect_os)
    local cpu=$(detect_cpu)
    local gpu=$(detect_gpu)
    local webgpu_support=$(check_webgpu_support)
    
    echo "OS: $os"
    echo "CPU: $cpu" 
    echo "GPU: $gpu"
    echo "WebGPU Support: $webgpu_support"
    echo ""
    
    # Determine best installation strategy
    local install_strategy=""
    local install_command=""
    
    # Store GPU-specific info for fallback
    local gpu_specific_strategy=""
    local gpu_specific_command=""
    
    if [[ "$gpu" == "cuda" ]]; then
        gpu_specific_strategy="CUDA GPU acceleration"
        gpu_specific_command="./start_jupyter.sh"
    elif [[ "$gpu" == "metal" ]]; then
        gpu_specific_strategy="Metal GPU acceleration"
        gpu_specific_command="./start_jupyter.sh"
    elif [[ "$webgpu_support" == "true" ]]; then
        gpu_specific_strategy="WebGPU browser acceleration"
        gpu_specific_command="./start_jupyter_webgpu.sh"
    else
        gpu_specific_strategy="CPU-optimized with Rust kernel"
        gpu_specific_command="./quick_start_rust_kernel.sh"
    fi
    
    # Default to hybrid
    install_strategy="Hybrid Python + Rust dual-kernel"
    install_command="./start_jupyter_hybrid.sh"
    
    echo -e "${GREEN}ğŸ¯ Default (Recommended): Hybrid Environment${NC}"
    echo -e "${GREEN}ğŸ¯ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæ¨å¥¨ï¼‰: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç’°å¢ƒ${NC}"
    echo "     ğŸ¦€ğŸ Dual-kernel Jupyter with both Python and Rust support"
    echo "     ğŸ¦€ğŸ Pythonç’°å¢ƒã¨Rustç’°å¢ƒã®ä¸¡æ–¹ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚«ãƒ¼ãƒãƒ«"
    echo ""
    echo -e "${BLUE}Alternative: $gpu_specific_strategy${NC}"
    echo "     GPU-optimized single environment"
    echo "     GPUæœ€é©åŒ–ã•ã‚ŒãŸå˜ä¸€ç’°å¢ƒ"
    echo ""
    
    # Ask user for setup type (auto-select default for non-interactive mode)
    echo "Choose installation type:"
    echo "[1] Hybrid (Default - Python + Rust dual-kernel) â­"
    echo "[2] GPU-Optimized ($gpu_specific_strategy)"
    echo "[q] Cancel"
    echo ""
    
    # Check if running interactively
    if [[ -t 0 ]]; then
        read -p "Select [1/2/q] (default: 1): " -n 1 -r
        echo
    else
        echo "Non-interactive mode detected. Auto-selecting default option [1]..."
        REPLY="1"
    fi
    
    case $REPLY in
        1|"")
            echo "Using hybrid setup (default)..."
            ;;
        2)
            install_strategy="$gpu_specific_strategy"
            install_command="$gpu_specific_command"
            echo "Using GPU-optimized setup..."
            ;;
        q|Q)
            echo "Installation cancelled."
            exit 0
            ;;
        *)
            echo "Invalid selection. Using hybrid setup (default)..."
            ;;
    esac
    
    echo ""
    echo "ğŸš€ Starting Installation / ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«é–‹å§‹"
    echo "==========================================="
    
    # Set up working directory and track project path
    local project_dir=""
    local rustorch_home="$HOME/.rustorch"
    mkdir -p "$rustorch_home"
    
    # Primary approach: Clone the complete repository
    if command -v git >/dev/null 2>&1; then
        echo "ğŸ“¦ Setting up complete RusTorch project..."
        
        if [[ -d "$rustorch_home/rustorch" ]]; then
            # Check if it's a valid git repository
            if [[ -d "$rustorch_home/rustorch/.git" ]]; then
                echo "ğŸ”„ Updating existing RusTorch installation..."
                cd "$rustorch_home/rustorch"
                git pull
            else
                echo "ğŸ”„ Existing directory is not a git repository. Recreating..."
                rm -rf "$rustorch_home/rustorch"
                cd "$rustorch_home"
                git clone https://github.com/JunSuzukiJapan/rustorch.git
                cd rustorch
            fi
        else
            echo "ğŸ“¥ Cloning RusTorch repository..."
            cd "$rustorch_home"
            git clone https://github.com/JunSuzukiJapan/rustorch.git
            cd rustorch
        fi
        
        chmod +x *.sh
        eval "$install_command"
        project_dir="$rustorch_home/rustorch"
        cd - > /dev/null
    else
        echo "âš ï¸  Git not found. Using fallback approach..."
        echo "ğŸ”„ Attempting script download method..."
        
        # Fallback: Download essential files individually
        local script_name=$(basename "$install_command")
        echo "ğŸ“¥ Downloading $script_name..."
        
        if curl -sSL "https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/$script_name" -o "$script_name"; then
            chmod +x "$script_name"
            echo "âœ… Downloaded $script_name successfully"
            
            # Create installation directory and download essential files
            if [[ -d "$rustorch_home/rustorch" ]]; then
                echo "ğŸ”„ Updating existing installation..."
                cd "$rustorch_home/rustorch"
            else
                echo "ğŸ“¦ Setting up RusTorch installation in $rustorch_home..."
                mkdir -p "$rustorch_home/rustorch"
                cd "$rustorch_home/rustorch"
                
                # Download essential project files
                echo "ğŸ“¥ Downloading essential project files..."
                curl -sSL "https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/Cargo.toml" -o "Cargo.toml" || echo "Warning: Could not download Cargo.toml"
                
                # Download all necessary scripts
                for script in "start_jupyter_quick.sh" "start_jupyter_hybrid.sh" "download_notebooks.sh"; do
                    curl -sSL "https://raw.githubusercontent.com/JunSuzukiJapan/rustorch/main/$script" -o "$script" || echo "Warning: Could not download $script"
                    chmod +x "$script" 2>/dev/null || true
                done
            fi
            
            # Copy and run installer script
            if [[ ! -f "./$script_name" ]]; then
                cp "$OLDPWD/$script_name" . 2>/dev/null || echo "Note: Script already available"
            elif ! cmp -s "$OLDPWD/$script_name" "./$script_name" 2>/dev/null; then
                cp "$OLDPWD/$script_name" . 2>/dev/null || echo "Note: Using existing script"
            else
                echo "âœ… Script already exists and is up to date"
            fi
            
            eval "./$script_name"
            project_dir="$rustorch_home/rustorch"
            cd - > /dev/null
            
            # Clean up
            if [[ -f "$script_name" ]] && [[ "$PWD/$script_name" != "$rustorch_home/rustorch/$script_name" ]]; then
                rm -f "$script_name"
            fi
        else
            echo "âŒ Failed to download $script_name"
            echo "âŒ Both git and curl approaches failed. Please install git or check your internet connection."
            exit 1
        fi
    fi
    
    echo ""
    echo "ğŸ“¦ Creating launcher script / ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ"
    echo "=================================================="
    
    # Create launcher script with project path
    local launcher_path=$(create_launcher "$install_strategy" "$project_dir")
    echo -e "${GREEN}âœ… Launcher created: $launcher_path${NC}"
    
    # Add to PATH
    add_to_path "$INSTALL_PATH"
    
    echo ""
    echo -e "${GREEN}ğŸ‰ Installation Complete! / ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ï¼${NC}"
    echo "=============================================="
    echo ""
    echo "ğŸ“‹ Usage / ä½¿ç”¨æ–¹æ³•:"
    echo "  1. Restart your terminal / ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’å†èµ·å‹•"
    echo "  2. Run anywhere: ${BLUE}rustorch-jupyter${NC}"
    echo "  3. Or directly: ${BLUE}$launcher_path${NC}"
    echo ""
    echo "ğŸ› ï¸  Advanced Options / é«˜åº¦ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³:"
    echo "  ${BLUE}rustorch-jupyter --help${NC}              # Show help / ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º"
    echo "  ${BLUE}rustorch-jupyter --dir <path>${NC}        # Use custom directory / ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨"
    echo "  ${BLUE}rustorch-jupyter --uninstall${NC}         # Uninstall / ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
    echo ""
    echo "ğŸ“ Installation details / ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è©³ç´°:"
    echo "  â€¢ Project location: ${BLUE}$project_dir${NC}"
    echo "  â€¢ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´æ‰€: ${BLUE}$project_dir${NC}"
    echo "  â€¢ Launcher script: ${BLUE}$launcher_path${NC}"
    echo "  â€¢ ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: ${BLUE}$launcher_path${NC}"
    echo ""
    echo "ğŸ”§ Customization / ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º:"
    echo "  Install path: ${BLUE}RUSTORCH_INSTALL_PATH=/custom/path $0${NC}"
    echo ""
    echo "ğŸ’¡ Note: You can now run ${BLUE}rustorch-jupyter${NC} from any directory!"
    echo "ğŸ’¡ æ³¨æ„: ${BLUE}rustorch-jupyter${NC}ã¯ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ï¼"
    echo ""
    echo "ğŸ—‘ï¸  To uninstall later / å¾Œã§ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯:"
    echo "   ${BLUE}rustorch-jupyter --uninstall${NC}"
    echo ""
}

# Handle command line arguments
if [[ "$1" == "--help" ]] || [[ "$1" == "-h" ]]; then
    echo "RusTorch Universal Jupyter Installer"
    echo ""
    echo "Usage:"
    echo "  $0                    # Install with auto-detection"
    echo "  $0 --help            # Show this help"
    echo ""
    echo "Environment Variables:"
    echo "  RUSTORCH_INSTALL_PATH # Custom install path (default: ~/bin)"
    echo ""
    exit 0
fi

# Run main installation
main

